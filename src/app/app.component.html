<!-- ========== THE EPONYMOUS GLOBAL TOOLTIP ========== -->
<app-tooltip></app-tooltip>

<!-- ========== NAVIGATION BAR ========== -->
<mat-toolbar color="primary" style="position: fixed; top: 0; height: 80px; z-index: 100;">
  <span style = "margin-left: 5%;"><h1>Steam Monkey</h1></span>
  <span class="spacer"></span>
  <form (submit)="$event.preventDefault()" style="margin-top: 20px">
    <mat-form-field>
      <mat-label style="user-select: none;">Game name</mat-label>
      <input matInput type="search" [formControl]="searchControl" [matAutocomplete]="auto">
      <mat-autocomplete #auto="matAutocomplete" panelWidth="500px"
                        [displayWith]="extractGameName"
                        (optionSelected)="onGameSelection($event.option)">
        <mat-option *ngFor="let game of filteredData | async" [value]="game">
          <span>{{game.name}}</span>
          <span class="spacer"></span>
          <img src="{{game.header_image}}" alt="Game image" style="height: 40px">
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
  </form>
  <a href="https://store.steampowered.com/app/{{currentGame.appid}}" target="_blank">
    <img src="assets/icon.png" alt="Steam icon"  style="height: 50px; width: 50px; margin-left: 30px; ">
  </a>
</mat-toolbar>

<!-- CONTAINER FOR ENTIRE PAGE WITHOUT NAV BAR -->
<div class="container-whole">
  <!-- Clearance below nav bar -->
  <div style="height: 90px"></div>


  <!-- ========== SINGLE GAME INFO ========== -->
  <!-- Header -->
  <mat-card class="game-card">
    <mat-card-header>
      <!-- WHY IS THIS IN REVERSE?!?!?!??!? IT REFUSES TO DISPLAY THEM IN THE RIGHT ORDER? -->
      

      <img mat-card-xxl-image [attr.src]="currentGame.header_image" class="game-card-image" alt="Cover photo" />
      <div style="display: flex; width: 100%;">
        <div class="header-card">
          <h1>{{currentGame.name}}</h1>
          <b>Genres:</b>
          <div class="round-bordered">
            <ul  class = "general-list" #genreList>
              <li class = "general-item" *ngFor="let genre of currentGame.genre">{{genre}}</li>
            </ul>
          </div>
        </div>
        <div class="right-header-card">
          <h1>Platforms</h1>
          <div class="round-bordered">
            <mat-list>
              <mat-list-item>
                <b>Windows: </b>
                <mat-icon #winSupport>{{supportToIconName(currentGame.platforms.windows)}}</mat-icon>
              </mat-list-item>
              <mat-list-item>
                <b>Linux: </b>
                <mat-icon #linuxSupport>{{supportToIconName(currentGame.platforms.linux)}}</mat-icon>
              </mat-list-item>
              <mat-list-item>
                <b>Mac: </b>
                <mat-icon #macSupport>{{supportToIconName(currentGame.platforms.mac)}}</mat-icon>
              </mat-list-item>
            </mat-list>
          </div>  
        </div>
      </div>
    </mat-card-header>

    <mat-card-content>
      
      <h2>Categories:</h2>
      <div class="round-bordered">
        <ul class = "general-list" #categoryList>
          <li class = "general-item" *ngFor="let category of currentGame.categories">{{category}}</li>
        </ul>
      </div>
      <h2>Tags:</h2>
      
      <div class="round-bordered">
        <ul  class = "general-list"  #tagList>
          <li class = "general-item" *ngFor="let tag of currentGame.tags | keyvalue">{{tag.key}}</li>
        </ul >
      </div>
      <h2>Languages:</h2>
      <div class="round-bordered">
        <ul class = "general-list"  #languageList>
          <li class = "general-item" *ngFor="let language of currentGame.languages.split(', ')">{{language}}</li>
        </ul>
      </div>
      
    </mat-card-content>
  </mat-card>

  <span style="margin-block-end: 5%;"></span>
  <!-- First row -->
  <mat-card class="game-card" style="position: static;">
    <div class="two-col-container vis-parent">
      <div class="col">
        <h2 style="margin-inline-start: 5%;">Popularity Metrics</h2>
        <app-radar instanceId="categoricalDataRadar" class="vis-component" [height]=400
                   [centerHorizontalOffset]=225 [centerVerticalOffset]=200 [maxRadius]=150>
        </app-radar>
      </div>

      <div class="col">
        <app-box instanceId="categoricalDataBox" class="vis-component" [height]=500 [width]=550
                 >
        </app-box>
      </div>
    </div>
  </mat-card>


  <!-- Second row -->
  <div class="two-col-container game-card">
    <!-- TODO: Replace testing dummy with check of existence of Metacritic data once processing is complete -->
    <mat-card class="col">
     
      <div style="display: flex; flex-direction: row;">
        <h2 style="margin-inline-start: 10%; margin-inline-end: 2%;">Game Reviews      </h2>
        <mat-icon (mouseenter)="onEnterGameReviews()" (mouseleave)="onLeaveGameReviews()" style="margin-top: 20px;">help_outline</mat-icon>
      </div>
      
      <app-bar instanceId="scoresBar"  *ngIf="hasMetaDummy; else steamReviewsPie" [margin] = 80 [width]=600 [height]=300></app-bar>
    
      <ng-template #steamReviewsPie>
        <app-pie instanceId="steamReviewsPie"></app-pie>
      </ng-template>
    </mat-card>
    <mat-card class="col">
      <div style="display: flex; flex-direction: row;">
        <h2 style="margin-inline-start: 10%; margin-inline-end: 2%;">Game Completion      </h2>
        <mat-icon (mouseenter)="onEnterGameCompletion()" (mouseleave)="onLeaveGameReviews()" style="margin-top: 20px;">help_outline</mat-icon>
      </div>
      <app-donut instanceId="gameCompletionPie" [margin] = 80 [w]=300 [h]=300></app-donut>
    </mat-card>
  </div>

  <!-- Third row -->
  <div style="position: relative;
  margin-inline-start: auto;
  margin-inline-end: auto;
  width: 80%;
  max-width: 80%;
  margin-block-end: 1%;
">
    <mat-card>
      <div>
        <div style="display: flex; flex-direction: row; margin-block-end: 0%;">
          <h2 style="margin-inline-start: 10%; margin-inline-end: 2%; margin-block-end: 0%;">Likes in past 30 days      </h2>
          <mat-icon (mouseenter)="onEnterLikes30Days()" (mouseleave)="onLeaveGameReviews()" style="margin-top: 20px;">help_outline</mat-icon>
        </div>
        <app-line instanceId="likesOverTimeLine" [width] = 1400></app-line>
      </div>  
    </mat-card>
  </div>

  <!-- Fourth row -->
  <div style="position: relative;
  margin-inline-start: auto;
  margin-inline-end: auto;
  width: 80%;
  max-width: 80%;
  margin-block-end: 1%;
">
    <mat-card>
      <div>
        <div style="display: flex; flex-direction: row; margin-block-end: 0%;">
          <h2 style="margin-inline-start: 10%; margin-inline-end: 2%; margin-block-end: 0%;">Daily CCU      </h2>
          <mat-icon (mouseenter)="onEnterCCU30Days()" (mouseleave)="onLeaveGameReviews()" style="margin-top: 20px;">help_outline</mat-icon>
        </div>
        <app-line instanceId="ccuOverTimeLine" [width] = 1400></app-line>
      </div>  
    </mat-card>
  </div>



  <!-- ========== MULTIPLE GAME INFO ========== -->
  <mat-divider></mat-divider>
  <div style="position: relative;
  margin-inline-start: auto;
  margin-inline-end: auto;
  width: 80%;
  max-width: 80%;
  margin-block-end: 1%;">
    <h1 style="text-align: center;">General Information About Steam Games</h1>
  </div>
  <!-- Numeric data correlation -->
  <div>
    <app-bin-scatter instanceId="numericDataBinScatter" [currentAppId]="currentGame.appid"></app-bin-scatter>
  </div>

  <!-- Second row -->
  <div class="two-col-container game-card">
    <!-- TODO: Replace testing dummy with check of existence of Metacritic data once processing is complete -->
    <mat-card class="first-col">
     
      <div style="display: flex; flex-direction: row; margin-block-end: 0%;">
        <h2 style="margin-inline-start: 10%; margin-inline-end: 2%; margin-block-end: 3%;">Number of games for each genre</h2>
        <mat-icon (mouseenter)="onEnterGenreCount()" (mouseleave)="onLeaveGameReviews()" style="margin-top: 20px;">help_outline</mat-icon>
      </div>
      <app-bar instanceId="genreCountBar" [margin] = 80 [width]=700 [height]=400 style="margin-inline-start:auto; margin-inline-end:auto;"></app-bar>

    </mat-card>
    <mat-card class="col">
      <div style="display: flex; flex-direction: row;">
        <h2 style="margin-inline-start: 10%; margin-inline-end: 2%;">Game Completion      </h2>
        <mat-icon (mouseenter)="onEnterGameCompletion()" (mouseleave)="onLeaveGameReviews()" style="margin-top: 20px;">help_outline</mat-icon>
      </div>
      <app-pie instanceId="priceBracketsPie" class="first-col"></app-pie>
    </mat-card>
  </div>
  




  <!-- ========== GENRE INFO ========== -->
  <mat-divider></mat-divider>
  <h1 style="text-align: center;">Genre-specific Information</h1>

  <!-- Genre selector -->
  <div style="height: 20px"></div>
  <div style="margin: auto; width: 50%; text-align: center;">
    <mat-form-field appearance="fill" color="primary">
      <mat-label>Genre</mat-label>
      <mat-select [(value)]="currentGenre" (selectionChange)="onGenreSelection($event.value)" placeholder="Mode">
        <mat-option *ngFor="let genre of currentGame.genre" [value]="genre">{{genre}}</mat-option>
      </mat-select>
      <mat-hint align="start">Select a genre</mat-hint>
    </mat-form-field>
  </div>
  <div style="height: 20px"></div>

  <!-- Game release date timeline -->
  <div style="position: relative;
  margin-inline-start: auto;
  margin-inline-end: auto;
  width: 80%;
  max-width: 80%;
  margin-block-end: 1%;
  ">
    <mat-card>
        <div>
          <h2 style="margin-inline-start: 5%;">Genre Releases Timeline</h2>
          <app-line instanceId="gameReleaseLine" [width]=1100></app-line>
        </div>
    </mat-card>
  </div>

  <!-- Genre version of game info -->
  <div style="position: relative;
  margin-inline-start: auto;
  margin-inline-end: auto;
  width: 80%;
  max-width: 80%;
  margin-block-end: 1%;
  ">
    <mat-card>
      <div mat-card class="three-col-container vis-parent">
        <h2 style="margin-inline-start: 5%;">Genre Data</h2>
        
        <div class="col">
          <app-radar instanceId="genreCategoricalDataRadar" class="vis-component"
                      [centerVerticalOffset]=150 [centerHorizontalOffset]=200 [width]=400 [height]=300 [margin]=0 [maxRadius]=100>
          </app-radar>
        </div>

        <div class="col">
          <app-box  instanceId="genreCategoricalDataBox" class="vis-component" [width]=500 [height]=400 [boxHeight]=35
                    [margin]="{top: 40, right: 25, bottom: 40, left: 10}">
          </app-box>
        </div>
        
        <div class="col">
          <app-pie instanceId="genreCompletionPie" class="vis-component" [height]=400 [horizontalMargin]=500 [legendHorizontalOffset]=300></app-pie>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Genre CCU timeline w/ game CCU data -->
  <div style="position: relative;
  margin-inline-start: auto;
  margin-inline-end: auto;
  width: 80%;
  max-width: 80%;
  margin-block-end: 1%;
  ">
    <mat-card>
      <div>
        <h2 style="margin-inline-start: 5%;">Genre CCU Timeline</h2>
        <app-line instanceId="genreCcuLine" [width]=1100></app-line>
      </div>
    </mat-card>
  </div>

</div>
